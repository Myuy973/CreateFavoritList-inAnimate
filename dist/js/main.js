(()=>{"use strict";class e{constructor(e,t,n,i){this.id=e,this.anime_name=t,this.onair=n,this.site_link=i}}class t{constructor(e,t,n,i,r){this.id=e,this.anime_name=t,this.onair=n,this.day_of_week=i,this.site_link=r}}var n=999,i="",r=[];const l=/[曜日放送のテレビアニメ]/;function s(e){chrome.runtime.sendMessage(e,(()=>{chrome.runtime.lastError}))}window.addEventListener("scroll",(()=>{if("月別"==i||"曜日別"==i){const e=[...document.querySelectorAll("h2.c-heading-h2[id]")].map((e=>{var t=e.getBoundingClientRect().top;if(window.innerHeight>=t&&0<t)return e.getAttribute("id")})).filter((e=>e))[0];n!=e&&s({type:"show_now",message:e}),n=e}})),chrome.runtime.onMessage.addListener(((n,o,a)=>{switch(console.log(n.type),n.type){case"start":const o=document.getElementsByTagName("h1")[0].innerText;if(i="",o.match(/[月放送開始]/))i="月別",r=[],document.querySelectorAll("h2[id]").forEach((t=>{const n=t.getAttribute("id"),i=t.innerText,l=t.nextElementSibling.querySelector("table").querySelectorAll("td"),[s]=[...l].map((e=>{if("放送スケジュール"==e.innerText)return e.nextElementSibling.innerText.replace("\n"," ")})).filter((e=>e)),o=t.nextElementSibling.getElementsByTagName("a"),[a]=[...o].map((e=>{if(e.innerText.endsWith("公式サイト"))return e.origin})).filter((e=>e));r.push(new e(n,i,s,a))}));else{if(!o.match(/[曜日別]/))break;console.log("曜日別"),i="曜日別",function(){r=[];const e=document.querySelectorAll("h3.c-heading-h3, a[href*='#']:not([id]");var n="";e.forEach(((e,i)=>{if("H3"==e.tagName)return e.innerText.match(l)?(n=e.innerText.slice(0,1),void r.push(n+" -----------------")):void 0;if("A"==e.tagName){const i=e.hash.slice(1),l=e.innerText,s="h2[id='"+i+"']",o=document.querySelector(s).nextElementSibling.innerText.replace("放送局：",""),a=document.querySelector(s).nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.getElementsByTagName("a")[0].getAttribute("href");r.push(new t(i,l,o,n,a))}}))}()}s({type:i,message:r});break;case"create":console.log(n.data)}}))})();